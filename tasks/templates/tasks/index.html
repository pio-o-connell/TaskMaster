{% extends 'tasks/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
  <div class="row">
    <div class="col-12 mb-3 d-flex justify-content-between align-items-center">
      <h1 class="m-0">Taskmaster</h1>
      <button type="submit" form="task-create-form" class="btn btn-primary">Add Task</button>
    </div>
  </div>

  <!-- New Task form (just below the heading) -->
  <div class="row mb-4">
    <div class="col-12">
      <form method="post" class="task-form" id="task-create-form">
        {% csrf_token %}
        <div class="d-flex flex-wrap align-items-end gap-2">
          {% crispy form %}
        </div>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="col-12 col-md-6 mb-4">
      <h3>To do</h3>
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-light">
            <tr>
              <th scope="col">Title</th>
              <th scope="col">Due Date</th>
              <th scope="col">Category</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for task in upcoming_tasks %}
              <tr>
                <td>{{ task.title }}</td>
                <td>{% if task.due_date %}{{ task.due_date }}{% else %}-{% endif %}</td>
                <td>{{ task.category }}</td>
                <td>
                  <form method="post" action="{% url 'task-complete' task.pk %}" style="display:inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link p-0 text-success me-2" title="Mark completed"><i class="fa-solid fa-check fa-fw"></i></button>
                  </form>
                  <a href="{% url 'task-edit' task.pk %}" class="text-primary me-2" title="Edit"><i class="fa-solid fa-pen-to-square fa-fw"></i></a>
                  <form method="post" action="{% url 'task-delete' task.pk %}" style="display:inline" onsubmit="return confirm('Delete this task?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link p-0 text-danger" title="Delete"><i class="fa-solid fa-trash fa-fw"></i></button>
                  </form>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="text-muted">No tasks to do. Use the Admin to add tasks.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-12 col-md-6 mb-4">
      <h3>Done</h3>
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-light">
            <tr>
              <th scope="col">Title</th>
              <th scope="col">Due Date</th>
              <th scope="col">Category</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for task in completed_tasks %}
              <tr>
                <td>{{ task.title }}</td>
                <td>{% if task.due_date %}{{ task.due_date }}{% else %}-{% endif %}</td>
                <td>{{ task.category }}</td>
                <td>
                  <form method="post" action="{% url 'task-reopen' task.pk %}" style="display:inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link p-0 text-secondary me-2" title="Reopen"><i class="fa-solid fa-rotate-left fa-fw"></i></button>
                  </form>
                  <a href="{% url 'task-edit' task.pk %}" class="text-primary me-2" title="Edit"><i class="fa-solid fa-pen-to-square fa-fw"></i></a>
                  <form method="post" action="{% url 'task-delete' task.pk %}" style="display:inline" onsubmit="return confirm('Delete this task?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link p-0 text-danger" title="Delete"><i class="fa-solid fa-trash fa-fw"></i></button>
                  </form>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="text-muted">No completed tasks yet.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

{% endblock %}
